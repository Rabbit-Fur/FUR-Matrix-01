{% extends "layout.html" %}
{% set bg_image = resolve_background_template() %}
{% set bg_image = "/static/bg/reminders.png" %}
{% block title %}{{ _('reminder_admin_title') }}{% endblock %}

{% block content %}
<h1>{{ _('reminder_admin_title') }}</h1>

<table class="table">
  <thead>
    <tr>
      <th>{{ _('reminder_message') }}</th>
      <th>{{ _('reminder_time') }}</th>
      <th>{{ _('participants') }}</th>
      <th>{{ _('actions') }}</th>
    </tr>
  </thead>
  <tbody>
    {% for r in reminders %}
    <tr>
      <td>{{ r['message'] }}</td>
      <td>{{ r['send_time'] or 'â€“' }}</td>
      <td>
        <button onclick="loadParticipants({{ r['id'] }})">ğŸ‘¥ {{ _('view') }}</button>
      </td>
      <td>
        <button onclick="sendNow({{ r['id'] }})">ğŸ“¤ {{ _('send_now') }}</button>
        <button onclick="deactivate({{ r['id'] }})">ğŸ›‘ {{ _('deactivate') }}</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div id="participants" class="panel" style="margin-top:20px;"></div>

<script>
function loadParticipants(id) {
  fetch(`/api/reminders/${id}/participants`)
    .then(r => r.json())
    .then(data => {
      document.getElementById('participants').innerHTML =
        `<h3>{{ _('participants') }} â€“ Reminder ${id}</h3><pre>` +
        JSON.stringify(data, null, 2) +
        `</pre>`;
    });
}

function sendNow(id) {
  fetch(`/api/reminders/${id}/send`, { method: "POST" })
    .then(() => alert("âœ… {{ _('reminder_sent') }}"));
}

function deactivate(id) {
  fetch(`/api/reminders/${id}/deactivate`, { method: "POST" })
    .then(() => alert("ğŸš« {{ _('reminder_deactivated') }}"));
}
</script>
{% endblock %}
