{% extends "layout.html" %}
{% block content %}
<h1>{{ _('reminder_admin_title') }}</h1>

<table border="1" cellpadding="8">
  <tr>
    <th>{{ _('reminder_message') }}</th>
    <th>{{ _('reminder_time') }}</th>
    <th>{{ _('participants') }}</th>
    <th>{{ _('actions') }}</th>
  </tr>
  {% for r in reminders %}
  <tr>
    <td>{{ r['message'] }}</td>
    <td>{{ r['send_time'] }}</td>
    <td><button onclick="loadParticipants({{ r['id'] }})">{{ _('view') }}</button></td>
    <td>
      <button onclick="sendNow({{ r['id'] }})">{{ _('send_now') }}</button>
      <button onclick="deactivate({{ r['id'] }})">{{ _('deactivate') }}</button>
    </td>
  </tr>
  {% endfor %}
</table>

<div id="participants" style="margin-top:20px;"></div>

<script>
function loadParticipants(id) {
  fetch(`/api/reminders/${id}/participants`)
    .then(r => r.json())
    .then(data => {
      document.getElementById('participants').innerHTML =
        `<h3>Participants for Reminder ${id}:</h3><pre>` +
        JSON.stringify(data, null, 2) +
        `</pre>`;
    });
}

function sendNow(id) {
  fetch(`/api/reminders/${id}/send`, { method: "POST" })
    .then(() => alert("âœ… Reminder sent!"));
}

function deactivate(id) {
  fetch(`/api/reminders/${id}/deactivate`, { method: "POST" })
    .then(() => alert("ðŸš« Reminder deactivated."));
}
</script>
{% endblock %}
